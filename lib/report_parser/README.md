# Reports Parser

## Зачем нужен Reports Parser

**Reports Parser** — это инструмент для парсинга типовых отчетов, которые формируются государственными органами. 

"Отчет" — это официальный документ в расширениях `.html`,`.xml`, `.docx`, `.xlsx`, `.xls`, который представляет собой последовательность таблиц и текстов. 

## Пример отчета, который можно обработать с помощью Reports Parser

Отчет с расширением `.html`, сформированный по результатам проведения процедуры оценки регулирующего воздействия (сокр.ОРВ) и [опубликованный](https://regulation.gov.ru/) на Федеральном портале проектов нормативных правовых актов:

![report_example1](https://user-images.githubusercontent.com/71979477/108358592-f66efc80-71ff-11eb-9d2c-9a8e43b8209b.PNG)

## Как работает Reports Parser

Парсер может быть использован для работы с документами, похожими по структуре на представленный выше пример.

В основе работы парсера — алгоритм рекурсии, который способен обходить дерево исходного документа и корректно распознавать отдельные его элементы. 

По результатам работы парсера пользователь получает объект типа `отчет`, который содержит последовательность таких элементов, каждый из которых является либо текстом (объект типа `Text`), либо таблицей (объект типа `pandas.DataFrame`). 

Данный инструмент успешно решает задачу обработки отчетов, содержащих сложно структурированные таблицы с большим уровнем вложенности.

С помощью **Reports Parser** пользователь может обработать отчеты, содержащие любое количество текстов и таблиц; данный инструмент успешно решает задачу обработки отчетов, содержащих сложно структурированные таблицы с большим уровнем вложенности. Парсер может быть применен к типовым государственным отчетам, написанным на любом языке.

Рекурсивный алгоритм распознает нужные элементы дерева парсинга исходного документа, опираясь на теги для расширений, с которыми умеет работать парсер. Теги хранятся в конфигурационном файле  `configfile.json`. 

Конфигурационный файл обрабатывается с помощью модуля `config_parser.py`.

## Тестирование 

Для оценки работы **Reports Parser** было реализовано unit-тестирование (всего реализовано 34 unit-теста). 

Основные тестовые сценарии в рамках unit-тестирования позволяют проверить корректность работы парсера на отчетах с расширениями  `.html`, `.docx`, `.xlsx`, `.xls`. 

Пользователь может самостоятельно протестировать парсер. Для этого можно запустить `test_report.py`, используя следующую команду:

```
python -m unittest -v test_report.py
```
## Использование 

Импортируем основной класс `Report` и вспомогательный класс для парсинга конфигурационного файла:

```python
from report import Report, ConfigParser
```
Загрузим конфигурационный файл и инициализируем экземпляр класса `Report`:

```python
example = 'report.html'
config = ConfigParser('configfile.json') 
report = Report(example, config)
```
Распарсим отчет:

```python
report.parse()
```
Распечатаем содержимое отчета:

```python
for text in report.texts():
    print(text)
for table in report.tables():
    print(table)
```
Результат работы парсера:

![report_example](https://user-images.githubusercontent.com/71979477/108381949-5faf3980-7219-11eb-8ebe-df194ebf7fdf.PNG)

**NB! В исходном отчете есть вложенность: в некоторых ячейках таблицы находятся другие таблицы. Парсер объединяет ячейки вложенной таблицы, разделяя их символом `|`.**


Найдем таблицу по предшествующему ей тексту:

```python
some_table = report.find_table_by_name('Общая информация')[0]
print('found', some_table)
```

![report_example2](https://user-images.githubusercontent.com/71979477/108382132-8c635100-7219-11eb-9716-02632629ba7a.PNG)

## Что делать, если нужное расширение не поддерживается?

Во-первых, нужно добавить названия тегов в конфигурационный файл (в большинстве случаев можно использовать теги для расширения `.html`).

Во-вторых, нужно найти конвертер, который может конвертировать нужный вам файл в один из используемых форматов (расширений).

В качестве альтернативы вы можете обратиться к команде разработчиков, которые попробуют решить вашу проблему.

## Лицензия

MIT license

## Контакты разработчиков

[Центр перспективных управленческих решений](https://cpur.ru/)

Мария Василевская, [m.vasilevskaia@cpur.ru]  
Арина Уксусова, [a.uksusova@cpur.ru]
